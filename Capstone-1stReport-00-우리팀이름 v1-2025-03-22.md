<!-- Template for PROJECT REPORT of CapstoneDesign 2025-2H, initially written by khyoo -->
<!-- 본 파일은 2025년도 컴공 졸업프로젝트의 <1차보고서> 작성을 위한 기본 양식입니다. -->
<!-- 아래에 "*"..."*" 표시는 italic체로 출력하기 위해서 사용한 것입니다. -->
<!-- "내용"에 해당하는 부분을 지우고, 여러분 과제의 내용을 작성해 주세요. -->

# Team-Info
| (1) 과제명 | *MANSION-VOMIC : 심리적 공포 체험을 원하는 게이머를 위해 보이스클로닝, STT-LLM-TTS를 이용한 방탈출 공포게임*
|:---  |---  |
| (2) 팀 번호 / 팀 이름 | *43-코코넛* |
| (3) 팀 구성원 | 손서희 (217683): 리더, *클라이언트 개발, UI/UX 디자인* <br> 이현정 (2276255): 팀원, *서버 개발 및 환경 구축, AI 개발* |
| (4) 팀 지도교수 | 심재형 교수님 |
| (5) 과제 분류 | *산학과제* |
| (6) 과제 키워드 | *게임, 보이스클로닝, STT, LLM, TTS*  |
| (7) 과제 내용 요약 | *플레이어가 음성을 통해 동료 플레이어와 소통하며 저택을 탈출하는 2인 방탈출 공포게임. 플레이어의 목소리를 클로닝한 뒤, AI 기반 기술 (STT, TTS, LLM)을 활용해 적대적 개체와 동료 플레이어를 구별하기 어렵게 만들어 시각적인 공포 요소 의존도를 낮추고 심리적 공포를 자연스럽게 유도한다. 두 명의 플레이어는 상호 협동을 통해 저택을 탐험하며 탈출을 위한 도구를 모으고 이는 다중 엔딩으로 이어진다. 이를 통해 플레이어에게 새로운 공포 경험과 2인 플레이 게임의 재미 요소를 제공하고자 한다.* |

<br>

# Project-Summary
| 항목 | 내용 |
|:---  |---  |
| (1) 문제 정의 | *현대 공포 게임의 패러다임은 한계에 직면했다. 대부분의 게임들은 단순히 혐오스러운 몬스터 그래픽과 갑작스러운 점프스케어에 의존하여 일시적인 공포감을 유발하지만, 이러한 방식은 곧 예측 가능해지고 플레이어의 몰입도를 급격히 감소시켜 몰입도에 부정적 영향을 준다. 특히 멀티플레이어 공포 게임은 플레이어 간 상호작용을 활용한 공포 연출이 제한적이다. 기존 게임들은 주로 환경 연출과 청각적 효과, 몬스터의 추적 패턴 등 외부적 자극에 의존하여 공포를 표현했지만, 이는 근본적인 심리적 공포를 야기하지 못한다. 본 프로젝트는 AI 음성 기술을 활용하여 이러한 문제를 해결하고자 한다. 핵심 기능은 몬스터가 플레이어의 음성을 모방하는 시스템이다. 플레이어들은 들리는 목소리가 동료의 것인지, 몬스터의 모방인지 구분할 수 없는 상황에 놓이게 되며, 이는 신뢰와 의심 사이의 긴장된 심리적 상태를 만들어낸다. 이를 통해 플레이어들은 단순한 생존 게임을 넘어서는 복합적인 심리적 경험을 하게 된다. 결과적으로 기존의 단방향적인 공포 구조를 넘어서, 신뢰와 의심이 교차하는 복합적인 심리적 공포 경험을 제공하고자 한다.
본 프로젝트의 주요 타겟 사용자는 새로운 게임 경험을 탐색하는 20-30대 공포게임 애호가들이다. 단순한 점프 스케어와 반복적인 몬스터 추적 패턴에 지친 플레이어들로, 게임에서 더 깊은 심리적 긴장감과 몰입을 원한다. 서브 타겟 사용자는 멀티게임 애호가들이다. 이들은 타 플레이어와의 지속적인 상호작용을 통한 게임 플레이를 즐기며, 주로 협력으로 연결감을 느낄 수 있는 게임 혹은 경쟁을 통해 긴장감을 유발하는 게임에 관심을 가진다. 본 프로젝트의 핵심은 AI 음성 기술을 활용하여 플레이어 간 상호작용의 근본적인 심리적 연결감을 변화시키는 것이다. 몬스터가 플레이어의 실시간 음성을 학습하고, 완벽하게 모방할 수 있는 시스템을 통해 플레이어들은 관계성과 심리적 긴장감을 중심으로 구성된 새로운 형태의 공포게임을 즐길 수 있다.*  |
| (2) 기존연구와의 비교 | *  기존의 공포 게임들은 주로 환경 연출과 사운드 효과, 몬스터의 추격과 같은 시청각적 자극에 의존하는 방식이었다. 협동/생존 게임의 대표적인 사례인 ‘Among Us’는 다수의 플레이어가 우주선 내 ‘임포스터‘와 ’크루원’으로 나뉘어 협력하고 배신하는 늑대인간류 게임이다. 크루원은 시민의 역할을 하며 임포스터를 찾고 미션을 수행하며, 임포스터는 늑대인간, 혹은 마피아의 역할을 하며 크루원을 제거하거나 미션을 방해한다. 게임 중 모든 플레이어는 역할에 상관없이 회의를 통해 투표로 제거할 플레이어를 한 명 고른다. 해단 게임은 플레이어 간의 의사소통과 신회가 게임의 핵심 요소로 작용해 김장감을 조성한다. 플레이어들은 서로의 행동을 관찰하고, 의사결정을 통해 신뢰를 구축하거나 배신하는 상황을 보여준다. 따라서 매 게임마다 플레이어가 변하거나 각자 맡은 역할이 변화하며 반복적인 게임에도 예측 불가능성을 제공한다. 하지만 게임의 주된 긴장감은 사회적 상호작용에 의존하기 때문에, 플레이어 간의 긴장감은 높지만, 공포감을 직접적으로 유도하는 요소가 거의 없다.
다음으로 ‘Phasmophobia’는 플레이어들이 유령을 사냥하는 팀 기반 공포 게임이다. 이는 사실적인 그래픽과 음향 효과를 통해 플레이어의 몰입감을 극대화할 수 있도록 설계되었다. 팀원은 각자 다양한 아이템을 사용해 유령의 정체를 파악하며 임무를 완수해야 한다. 협동이 중요한 요소로 자굥ㅇ하며, 팀원 간의 의사소통과 협력이 필수적이다. 그러나 유령의 행동 패턴이 고정되어 있어, 상호작용이 제한적이다. 또한 특정 상황에서 유령이 어떻게 반응하는지 예측할 수 있기 때문에, 플레이 경험이 쌓임에 따라 긴장감이 줄어드는 경향이 강하다. 또한 공포 요소가 환경적 자극, 즉 시청각적 자극에 의존하기 때문에, 반복적인 플레이를 통해 익숙해진 플레이어들이 느끼는 공포감이 급격히 약해질 수 있다. 따라서 해당 게임은 공포감 있으며 몰입감 있는 환경을 제공하지만, 신선한 경험을 지속적으로 제공하기 어려운 한계를 가지고 있다.
세 번째로 ‘Monstrum’은 한 명의 플레이어가 괴물에게 쫓기며 탈출하는 방식의 게임이다. 이 게임은 랜덤하게 생성된 환경에서 진행되며, 플레이어는 다양한 아이템을 통해 탈출한다. 랜덤 생성된 맵은 다른 매번 다른 게임 경험을 제공하여 플레이어들이 새로운 도전을 하도록 유도한다. 다양한 전략을 구사할 수 있는 여지가 있어 플레이어는 각 상황에 맞게 적절한 선택을 하도록 강요되어 긴장감이 유지된다. 하지만 괴물의 종류가 제한적이고 각 괴물은 일관적인 행동 패턴을 가지고 있다. 또한 이 패턴은 플레이어가 쉽게 파악할 수 있을 정도로 단순하여, 반복적인 플레이를 통해 긴장감과 공포감이 사라질 수 있다. 이로 인해 ‘Monstrum’은 훌륭한 공포 게임 요소를 보여주지만, 지속적으로 플레이하기에는 한계가 있다.
이과 같은 기존 게임들과 비교했을 때 본 과제는 차별적인 장점을 갖추고 있다. 가장 대표적으로, 몬스터가 플레이어의 실시간 음성을 학습하고 모방할 수 있는 시스템을 도입함으로써, 플레이어는 동료와 몬스터를 청각적으로 구분할 수 없는 환경을 통해 심리적 긴장감을 경험하게 된다. 이는 단순히 시각적 자극이나 환경적 요소에 의존하지 않고, 플레이어의 심리적 불안을 직접적으로 유도하는 방식으로 작용한다. 이를 통해 플레이어 간의 소통이 더욱 복잡하고 다층적으로 발전할 수 있다. 플레이어는 상대방의 목소리를 들었을 때 미세한 맥락과 뉘앙스 차이를 통해 진위를 파악해야하며, 이는 단순한 협력 이상의 전략적 사고를 요구한다. 또한 LLM와 AI 음성 기술을 통해 게임의 전개가 매번 예측 불가능하게 변한다. 이러한 예측 불가능성은 반복적인 패턴을 극복하고 지속적인 긴장감을 유지하는 데 기여한다. 몬스터는 플레이어들의 대화를 엿듣고 해당 상황에 적합한 행동과 대사를 취하며 플레이어들을 속이려고 시도한다. 플레이어들은 게임 내내 끊임없이 의심과 불안을 느끼며, 이는 기존 게임들이 지닌 한계를 극복하는 중요한 요소로 작용한다.* |
| (3) 제안 내용 | *  본 프로젝트는 2인이 협동하여 저택을 탈출하는 공포 게임으로, 플레이어들은 제한된 시간 내에 서로 음성으로 대화하며 힌트를 공유하고 아이템을 조합해야 한다. 이 게임의 클라이언트는 Unity 3D를 기반으로 하며, 멀티 플레이어 기능은 Photon을 통해 구현된다. 이러한 구조는 플레이어 간의 실시간 상호작용을 가능하게 하여 협동의 중요성을 강조한다.
가장 큰 차별점은 몬스터가 플레이어의 목소리를 학습하고 이를 기반으로 보이스 클로닝과 LLM(Large Language Model)을 통해 동료를 가장하는 것이다. 플레이어가 대화를 위해 마이크로 말을 하면, 해당 음성은 STT(Speech-to-Text) 기능을 통해 텍스트로 변환된다. 이 텍스트는 현재 게임 상황과 함께 GPT 기반의 LLM(Large Language Model)으로 전달되어, 비슷한 맥락의 대사가 자동으로 생성된다. 이후 생성된 대사는 TTS(Text-to-Speech) 기술과 음성 클로닝을 통해 플레이어의 실제 목소리와 유사한 음성으로 재구성된다. 이렇게 재구성된 음성은 몬스터가 플레이어의 목소리를 흉내내어 거짓 정보를 제공함으로써, 다른 플레이어들을 혼란에 빠뜨리거나 자신이 있는 쪽으로 유인하는 새로운 형태의 위협으로 작용한다.
해당 과정은 게임 내에서의 심리적 긴장감을 극대화하는 핵심 요소이다. 플레이어들은 동료와 협력해야 하면서도, 들리는 목소리가 진짜 동료의 것인지 아니면 몬스터의 것인지 끊임없이 의심해야 하는 상황에 놓이게 된다. 이는 협력의 필요성과 불신의 요소를 동시에 자아내어, 게임의 긴장감을 한층 더 고조시킵니다.
게임에 사용되는 공포 요소 또한 다양하다. 플레이 화면을 어둡게 하고 손전등 사용 범위를 제한하여 시야를 차단함으로써, 플레이어는 항상 불안감을 느끼게 된다. 또한, 스산한 BGM(배경음악)과 SFX(효과음)은 플레이어의 심리적 압박을 더욱 강화한다. 몬스터의 발소리는 거리에 따라 음량에 차이가 있도록 설계되어, 플레이어가 몬스터의 위치를 파악하는 데 도움을 주면서도, 몬스터가 주변에 있다는 긴장감을 유발한다.
특히, 보이스 클로닝은 플레이어가 자신의 목소리를 따라하는 몬스터와 대화해야 한다는 점에서 심리적 공포를 유발한다. 이로 인해 대화 상대가 동료가 아니라 몬스터일 수 있다는 가능성에서 오는 불안감은 게임의 핵심적인 공포 요소로 작용한다. 또한 대화 기회가 제한적이라는 점은 플레이어가 언제, 어떻게 대화를 시도할지를 전략적으로 고민하게 만든다. 이러한 요소들은 게임의 진행에 있어 플레이어에게 긴장감을 제공하고, 지속적인 협동과 더불어 빠른 상황 판단을 요구한다.
결론적으로, 본 프로젝트는 혁신적인 AI 기술을 활용하여 기존의 공포 게임들이 제공하지 못했던 깊은 심리적 경험을 창출하며, 협동과 불신의 복합적인 게임 경험을 통해 플레이어들에게 새로운 형태의 긴장감을 제공한다. 이러한 요소들은 게임의 몰입도를 높이고, 플레이어가 게임 세계에 더욱 깊게 빠져들 수 있도록 돕는 중요한 역할을 할 것이다.* |
| (4) 기대효과 및 의의 | *  본 프로젝트는 기존 공포 게임의 한계를 넘어서기 위한 시도이다. 실시간으로 음성을 학습하고 AI가 대사를 생성하여 이를 플레이어의 목소리로 재현하는 시스템은 게임의 몰입감을 높이는 것에 기여한다. 이러한 기술은 단순한 게임 플레이를 넘어 플레이어에게 현실적이고 강렬한 공포를 유발하는 동시에, 동료에 대한 의심과 심리적 불안을 조성한다. 이는 기존 게임에서는 경험하기 어려웠던 새로운 차원의 심리적 긴장감을 제공하며, 플레이어의 게임 몰입도과 예측 불가능성을 크게 향상할 수 있다.
이와 함께, 본 프로젝트는 AI 기술의 게임 내 활용 가능성을 입증함으로써, 향후 공포 장르뿐만 아니라 협동 게임, 추리 게임 등 다양한 장르로의 확장을 가능하게 한다. 이러한 기술은 게임의 구조와 시스템을 혁신적으로 변화시킬 수 있다. 예를 들어, 음성 클로닝과 AI 대사 생성 기술은 비선형 대화형 게임이나 NPC 대화 시스템에서도 활용될 수 있어, 게임 개발의 새로운 방향성을 제시한다.
더불어, 본 프로젝트는 심리적 반응과 AI 기술이 인간의 감정이나 행동에 미치는 영향을 탐구하는 데 중요한 사례로 작용할 수 있다. 플레이어의 심리적 반응을 분석함으로써, 게임 디자인에 있어 더 깊은 통찰을 제공할 것이다. 더 나아가 향후 게임 디자인뿐만 아니라, 인간-컴퓨터 상호작용 분야에서도 유용한 정보를 제공할 것으로 기대한다. 이러한 기술들은 향후 인공지능 기반의 사용자 경험을 개선하는 데 중요한 역할을 할 것이다.* |
| (5) 주요 기능 리스트 | *1. STT (Speech-to-Text)
- 스페이스바 입력 시 음성 녹음 시작
- STTManager.cs 가 AudioClip을 녹음함
- WavUtility.cs 파일을 통해 wav를 flac 포맷으로 변환 시킴
- FLAC 바이너리를 api 로 전송한 뒤 Google Cloud STT 사용
- 분리된 api_key.txt 파일에 Google STT, TTS 키를 저장해 보안성을 높임

2. LLM ( 프롬프팅에 걸맞게 몬스터의 답변 생성 )
- ChatGPTManager.cs 파일을 통해 STT로 얻은 텍스트를 GPT API 에 전송
- 프롬프팅을 통해 학습된 세계관에 받게 응답 메시지가 생성되고 수신됨

3. TTS (Text-to-Speech)
- GPT 응답 텍스트를 Google TTS API에 전송함
- MP3 오디오 데이터 수신
- Unity에서 오디오 재생 (몬스터가 직접 말하는 듯한 효과를 줌)

4. Voice Cloning (보이스 클론 : 사용자 음성 학습 기반)
- 게임 시작 전, 플레이어의 음성을 수 초간 녹음하는 보이스 클론 학습 단계를 제공
- 수집된 음성 데이터를 Voice Cloning API 에 전송하여 고유 음성 프로필 생성
- 이후 LLM이 생성한 응답은 클로닝된 음성으로 생성됨
- Unity에서 해당 음성 파일을 받아 AudioSource로 재생하여 몬스터가 플레이어의 목소리로 말하는 듯한 경험 제공

5. 멀티플레이어 매칭 및 룸 관리 (Photon PUN2 기반)
- 시작 화면에서 시작 버튼 선택으로 룸 생성 혹은 입장
- PhotonNetwork를 이용해 룸 생성 및 랜덤 매칭 구현
- 2명이 입장하면 게임 대기 상태로 전환됨
- 두 플레이어 모두 “준비 완료” 상태일 때 게임 시작

6. 캐릭터 조작 및 이동 시스템
- WASD 키로 기본 이동
- Shift 키를 누르고 이동 시 달리기 (누르고 있는 동안만 지속)
- Ctrl 키로 숙이기 (토글 방식: 한 번 누르면 숙이고, 다시 누르면 일어섬)

7. 문/서랍/가구 상호작용
- E 키 입력 시 문이나 서랍이 열리고 애니메이션 실행됨
- InteractableObject 스크립트를 통해 상호작용 기능 통합 관리

8. 인벤토리 시스템
- 인벤토리는 Tab 키로 열고 닫을 수 있으며, 열려 있을 땐 캐릭터 조작 불가
- 최대 6칸 구조의 슬롯으로 아이템 보관
- 아이템 선택, 버리기, 사용 기능
- 같은 아이템 여러 개를 가지고 있어도 슬롯은 개별로 사용함

9. 아이템 생성 및 상호작용
- 게임 시작 시 각 층마다 아이템이 무작위로 생성됨
- 아이템 종류와 개수는 사전에 정의된 값에 따라 결정됨
- 아이템은 가구 위 혹은 안에 주로 생성되며, 일부는 바닥에도 생성 가능
- 플레이어는 아이템을 줍거나 버릴 수 있고, 특정 장소에서 사용 가능

10. 대화 시스템 (음성 입력 제어)
- Space 키를 누르고 있는 동안만 음성 입력 가능
- 1회당 최대 5초까지 녹음, 한 게임당 총 4번 사용 제한
- 마이크 입력은 Unity Microphone API를 사용해 녹음

11. 몬스터 인공지능
- 몬스터는 5가지 상태를 가짐: 대기(Idle), 유인(Mimic), 추격(Chase), 탐색(Search), 공격(Attack)
- 유인 상태에서는 보이스 클로닝된 플레이어 목소리로 대사를 출력하여 다른 플레이어를 유도함
- 추격 상태에서는 플레이어가 시야에 들어오면 달려들고, 일정 시간 시야에서 벗어나면 탐색 상태로 전환
- 탐색 상태에서는 플레이어가 있을 것이라고 판단되는 장소 혹은 임의의 장소를 향해 걸어감.
- 공격상태에서는 몬스터가 플레이어를 잡을 경우 처치하며, 처치된 플레이어는 게임 오버 *|

<br>
 
# Project-Design & Implementation
| 항목 | 내용 |
|:---  |---  |
| (1) 요구사항 정의 |
[유스케이스]
<br>
1단계: 게임 시작 & 대기방

| 번호 | 기능 | 사용자 시나리오 | 조건 | 결과 |
| --- | --- | --- | --- | --- |
| UC0-1 | 게임 시작 | 플레이어가 "게임 시작" 버튼을 누름 | Photon 서버 연결됨 | 새로운 방 생성 또는 기존 방 자동 입장 |
| UC0-2 | 설정 | “설정” 버튼 누름 | - | 설정 팝업 열림 |
| UC0-3 | 게임 종료 | “나가기” 버튼 누름 | - | 프로그램 종료 |
| UC1-2 | 방 참가 완료 | 다른 플레이어가 방에 입장함 | 룸 인원 = 2 | 플레이어 목록에 추가됨 |
| UC1-3 | 준비 완료 | "준비 완료" 버튼 클릭 | 게임 시작 전, 본인만 클릭 | 준비 상태 true로 표시됨 |
| UC1-4 | 게임 시작 대기 | 두 명 모두 준비 상태가 됨 | 둘 다 isReady == true | 30초 대기 후 게임 시작 |

2단계: 본 게임 & 음성 및 몬스터

| 번호 | 기능 | 사용자 시나리오 | 조건 | 결과 |
| --- | --- | --- | --- | --- |
| UC2-1 | 아이템 줍기 | 아이템 근처에서 E 키를 누른다 | 충돌 범위 안, 인벤토리 공간 있음 | 인벤토리에 아이템 추가, 월드에서 제거 |
| UC2-2 | 아이템 버리기 | 인벤토리에서 아이템 선택 후 Q 키를 누른다 | 선택된 아이템 있음 | 인벤토리에서 제거, 현재 위치에 생성 |
| UC2-3 | 아이템 사용 | 특정 장소에 들어가 R 키를 누른다 | 해당 장소 조건 충족 | 탈출 이벤트 트리 |
| UC2-4 | 문/서랍 열기 | 오브젝트 근처에서 E 키를 누른다 | 트리거 범위 안 | 애니메이션 재생 및 열림 |
| UC2-5 | 옷장 숨기 | 옷장에서 E 키를 누른다 | 트리거 범위 안 | 몬스터 시야에서 은신 |
| UC2-6 | 이동하기 | WASD 키를 누른다 | 충돌하는 물체가 방향에 없음 | 해당 방향으로 이동 |
| UC2-7 | 달리기 | shift 키를 누른 상태로 이동 | - | 이동속도가 3배 증가 |
| UC2-8 | 숙이기 | Ctrl 키를 누른다 | - | 시야가 기존의 1/3 높이로 낮아짐 |
| UC3-1 | 음성 채팅(대화 녹음) | 스페이스 누르고 말함 | 남은 횟수 있음 | 마이크로 음성 녹음 후 Azure로 전송 |
| UC3-2 | STT 처리 | 음성 업로드 완료됨 | 서버 응답 대기 | 음성이 텍스트로 변환 |
| UC3-3 | GPT 대사 생성 | 텍스트 전달됨 | 맥락 정보 포함 | 유가 상황 대사 생성 |
| UC3-4 | 보이스 클로닝 출력 | 대사 생성 완료됨 |  Voice ID 존재 | 플레이어 목소리로 음성 파일 생성, 재생 |
| UC3-5 | TTS 처리 | GPT 대사가 생성됨 | 텍스트가 존재하고 Voice ID 존재 | 텍스트가 MP3 음성으로 변환되어 재생 |

3단계: 게임 종료

| 번호 | 기능 | 사용자 시나리오 | 조건 | 결과 |
| --- | --- | --- | --- | --- |
| UC4-1 | 탈출 성공 | 아이템 사용 후 탈출 경로 접근 | 조건 충족 | 게임 클리어 화면 전환 |
| UC4-2 | 플레이어 사망 | 몬스터에게 닿음 | isAlive == false | 캐릭터 사망 처리 |
| UC4-3 | 게임 종료 | 두 명 모두 사망 또는 한 명만 탈출 | - | - |
<br>
[클래스 다이어그램]
![클래스다이어그램](https://github.com/user-attachments/assets/7df4e542-be38-4d00-aae6-589931b3754b)
<br>
1. STTManager
-  역할: 마이크 입력을 녹음하고 FLAC으로 변환 후, Google STT API를 통해 텍스트로 인식. 인식된 텍스트를 이벤트로 전달함.

2. ChatGPTManager
- 역할: 인식된 텍스트를 OpenAI GPT API로 전송하고, GPT 응답을 받아 콜백으로 반환함.

3. TTSManager
- 역할: 텍스트를 Google TTS API에 전송하여 음성(MP3)으로 변환하고 Unity에서 재생함.

4. WavUtility
- 역할: AudioClip 데이터를 PCM 형식의 WAV 바이너리로 변환 (STT용 중간 포맷 생성)

5. GameManager
- 역할: 게임 상태를 전체적으로 관리 - 씬 전화, 시작 및 종료 처리

6. RoomManager
- 역할: Photon을 통해 방 생성, 입장, 플레이어 연결

7.Player
- 역할: 플레이어 캐릭터 상태 관리 및 조작

8. Inventory
- 역할: 아이템 보관/추가/삭제

9. Item
- 역할: 아이템 정보 – 종류, 사용 여부 등

10. Monster
- 역할: 플레이어 유인, 추격 및 공격

11. VoiceManager
- 역할: Azure 통신을 통해 음성 -> 텍스트 -> 대사 -> 음성 흐름 처리

12. InteractionObject- 역할: 문, 서랍 등 열 수 있는 오브젝트 정보 – 열림/닫힘 상태, 사용자 상호작용 등

|
| (2) 전체 시스템 구성 |
<img width="446" alt="전체 SW 시스템" src="https://github.com/user-attachments/assets/ad052133-1c0b-40e2-a608-9f1fb5919fe6" />

<br>

전체 시스템은 Unity Client, Photon 서버, Azure 서버, 그리고 AI Voice Pipeline으로 구성되며 각각의 모듈 간의 유기적인 연결을 통해 게임 구현이 된다.

Unity Client는 사용자가 조작하는 게임 환경으로 Game Logic은 실시간 게임 플레이를 담당하고 Photon SDK를 통해 Photon 서버와 통신하여 멀티 플레이어 간의 위치나 상호작용 데이터 동기화, 그리고 음성 소통을 제공한다. 동시에 Unity Client의 사용자 인터페이스는 Azure SDK 또는 REST API를 통해 Azure 서버와 연결되어 STT-LLM-TTS 요청을 처리한다.

사용자가 게임 중 음성 입력을 하면 Unity는 이를 녹음하여 Azure 서버로 전송하고, Azure 서버는 이를 AI Voice Pipeline에 전달하여 STT로 텍스트를 추출한 뒤, 해당 텍스를 기반으로 프롬프팅된 LLM을 통해 몬스터의 응답을 생성하고, TTS 를 사용해 음성으로 변환한다. 이때 음성은 보이스클론을 통해 생성된 음성을 사용하고자 한다. 이 음성은 다시 Azure 서버를 거쳐 Unity Client 로 전달되어 몬스터가 플레이어의 음성으로 응답해 몰입감 있는 게임 상호작용이 완성된다.
|
| (3) 주요엔진 및 기능 설계 |
1. Unity Client
사용자의 직접적인 조작이 이루어지는 게임 클라이언트로, 플레이어의 이동, 사물 및 아이템 상호작용, 인벤토리 시스템, 대화 입력 등의 실시간 게임 플레이 로직이 이곳에서 처리된다. 사용자 입력에 따라 발생하는 대부분의 게임 이벤트는 Unity 내부의 Game Logic에서 처리되며, 그 결과는 네트워크를 통해 상대방 플레이어에게 공유된다.  AI 음성 기능과도 연결되어 Azure 서버를 통해 데이터를 주고받는다. 플레이어가 Space 키를 누르고 대화할 경우, Unity는 마이크로부터 음성을 녹음하고, 이를 Azure로 전송해 일련의 과정을 거친 뒤, 최종적으로 음성을 받아 몬스터가 출력하도록 한다, 정리하면, Unity Client는 사용자 입력 처리와 외부 AI 모듈과 통신 허브 역할을 수행한다.

2. Photon SDK & Photon server
멀티플레이어 구현을 위해 Unity Client는 Photon SDK를 통해 Photon Server와 통신한다. Photon은 룸 생성 및 입장, 플레이어 상태 관리, 동기화 이벤트 처리 등 멀티 플레이어에 필요한 네트워크 기능을 지원한다. 두 명의 플레이어는 동일한 룸에 접속한 후, 위치 및 회전 정보가 실시간으로 동기화되며, 아이템 획득, 문/서랍 상호작용, 캐릭터 상태 등의 정보도 RPC(Remote Precedure Call)을 통해 서로 공유된다. 이를 통해 두 명의 플레이어는 같은 공간에 존재하는 것처럼 게임을 진행할 수 있다.

3. Azure server
 Unity client와 AI Voice Pipeline 사이의 중계 역할을 수행하며 음성 인식부터 응답 생성, 음성 합성까지의 요청 및 결과를 관리하다. 사용자의 음성 데이터는 Azure SDK 또는 REST API를 통해 서버로 전송되며, 서버는 이를 STT, LLM, TTS API에 순차적으로 전달하고 그 결과를 클라이언트(Unity) 로 반환한다. 보이스 클론 기능이 활성화가 된 경우에는 음성 샘플을 기반으로 고유한 음성 프로플도 생성하고 활용한다.
4. AI Voice Pipeline
AI Voice Pipeline은 사용자의 음성을 처리하여 텍스트를 생성하고, 이를 다시 음성으로 변환하는 세 단계의 AI 처리 흐름이다. STT API가 음성을 텍스트로 변환하고, LLM API 가 프롬프트 기반으로 응답 문장을 생성한 뒤 TTS API가 이를 음성으로 바꾼다. 이때, 보이스 클론된 샘플을 사용할 경우, 사용자의 목소리를 흉내 낸 몬스터의 응답 생성이 가능하다.|
| (4) 주요 기능의 구현 | 1. 프롬프팅된 LLM의 응답생성
 게임 내 몬스터는 플레이어의 음성 입력에 대해 세계관에 맞는 자연스러운 대사로 응답한다. 이 기능은 OpenAI의 GPT 기반 API를 활용한 LLM과의 연동을 통해 구현된다. 플레이어가 마이크를 통해 질문하거나 말을 하면 STTManager가 이를 텍스트로 변환하고, 변환된 텍스트는 ChatGPTManager를 통해 LLM API에 전달되다. 이때, 단순히 질문-응답이 아닌 게임 세계관을 반영한 프롬프팅이 적용된다. 프롬프트는 게임 스토리, 플레이가 진행된 상황 등으로 구성되며 이를 통해 적절한 대사가 생성된다. 또한 프롬프트는 LLM 요청 시 시스템 메시지로 주입되며, 플레이어의 발화가 사용자 메시지로 함께 전송된다. 이를 통해 각 상황별로 몰입감 있는 응답이 생성된다. 

2. 아이템 생성 및 상호작용
  게임 시작 시, 맵은 총 5개 층(B1, Floor1, Floor2, Floor3, Attic)으로 구성되어 있으며, 각 층 에 배치된 방들 내부에서 아이템이 무작위로 생성된다. 아이템은 총 11종이며, 각 아이템마다 생성 수량은 미리 정의되어 있고, 마법봉은 5% 확률로 생성된다. 각 층에서는 최소 2개에서 최대 6개의 아이템이 생성되며, 전체 생성 개수를 아이템별 제한 수량과 층별 개수를 모두 만족하도록 조절된다.
  아이템은 기본적으로 방 내부의 가구 위 또는 가구 안에 생성되며, 일부는 바닥에 직접 생성될 수 있다. 이를 위해 각 방에는 Room 태그를 부착하고, 가구는 크기에 따라 SmallFurniture 혹은 BigFurniture 태크를 적용한다. 아이템은 크기에 따라 큰 아이템과 작은 아이템으로 분류되며, 이에 따라 생성될 가구 유형도 달라진다. 각 가구에는 하나 이상의 SpawnPoint 오브젝트가 자식으로 배치되어 있으며, 이들은 SpawnPoint 태그를 가지고 있다. 해당 위치와 회전을 기준으로 아이템이 생성된다. 아이템은 바닥에 평평하게 눕은 방향으로 회전값이 조정되어 있어 현실감 있는 배치가 가능하다. 가구 오브젝트에 붙어서 가구가 열릴 때 함께 움직이도록 구성된다.
  아이템의 그래픽, 즉 프리팹은 Unity 에디터의 인스펙터에서 배열로 등록되며, 배열 순서에 따라 아이템의 종류 및 개수를 설정할 수 있다. 
  생성된 아이템은 플레이어가 상호작용할 수 있으며, 특정 키 입력을 통해 아이템을 줍거나 버릴 수 있다. 아이템을 획득하면 플레이어의 인벤토리에 등록되고 맵에서는 사라진다. 아이템을 버리면 플레이어의 인벤토리에서 삭제되고 플레이어 위치에 아이템이 생성된다. 획득한 아이템은 특정 조건을 만족하는 장소(탈출할 수 있는 장소)에서 사용할 수 있다.|
| (5) 기타 | 개발 완료 후 추가적인 기능 구현이 가능할 시, 다음과 같은 부가 기능을 추가할 예정이다.
1. 도움말 및 사용자 가이드 UI
- 상호작용 가능한 오브젝트 근처에서 “[E]를 눌러 열기” 등의 문구를 UI로 표시
- 인벤토리 여닫기, 아이템 버리기, 아이템 사용 시에도 상황별 안내 제공

2. 멀미 방지 기능
- 플레이어 시점 중앙에 작은 포커스 점을 표시해 시야 중심 고정
- 기본 이동 시 걷는 모션(위아래로 살짝 흔들림)으로 자연스러운 움직임 보완 예정

3. 도전과제 기능
- 게임 내에서 특정 조건을 완료할 시 해금됨.
- 반복으로 플레이를 하도록 동기 부여 및 수집 요소 제공

4. 플레이어마다 다른 엔딩 도달
- 같은 게임 내에서도 각 플레이어의 선택 혹은 확률에 따라 다른 엔딩을 볼 수 있도록 변경
- 예를 들어, 한 플레이어는 탈출에 성공해 게임을 클리어하고, 남은 플레이어는 몬스터에게 잡혀 게임 오버하는 등 가능 |

<br>
